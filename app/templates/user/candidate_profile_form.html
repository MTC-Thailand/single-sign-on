{% extends "base.html" %}

{% block content %}
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-two-thirds is-offset-2" x-data="formState()" x-init="init()" x-cloak>
                    <h1 class="title has-text-centered">ฟอร์มข้อมูลสำหรับแนะนำตนเอง</h1>
                    <h1 class="subtitle has-text-centered">สำหรับผู้สมัครรับเลือกตั้งกรรมการสภาเทคนิคการแพทย์วาระที่
                        8</h1>
                    <hr>
                    <h1 class="title is-size-6 has-text-centered has-text-danger">
                        ด้วยข้อจำกัดของขนาดเอกสารแนะนำตัว กรุณาป้อนข้อมูลไม่เกิน 720 ตัวอักษร
                    </h1>
                    <form method="post">
                        {{ form.hidden_tag() }}
                        <div class="box">
                            <h1 class="title is-size-4 has-text-centered">
                                ข้อมูลส่วนตัวผู้สมัคร
                            </h1>
                            <p class="help has-text-link has-text-centered">ข้อมูลส่วนนี้ไม่นับรวมในจำนวนตัวอักษรที่กำหนด</p>
                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">{{ form.title.label }}</label>
                                </div>
                                <div class="field-body">
                                    <div class="field">
                                        <p class="control is-expanded">
                                            {{ form.title(class="input") }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">{{ form.firstname.label }}</label>
                                </div>
                                <div class="field-body">
                                    <div class="field">
                                        <p class="control is-expanded">
                                            {{ form.firstname(class="input") }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="field is-horizontal">
                                <div class="field-label is-normal">
                                    <label class="label">{{ form.lastname.label }}</label>
                                </div>
                                <div class="field-body">
                                    <div class="field">
                                        <p class="control is-expanded">
                                            {{ form.lastname(class="input") }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box">
                            <h1 class="title is-size-4 has-text-centered">
                                ตำแหน่งงานปัจจุบัน
                            </h1>
                            {% for job_form in form.job_positions %}
                                <div class="field is-horizontal">
                                    <div class="field-label is-normal">
                                        <label class="label">{{ job_form.job_position.label }} {{ loop.index }}</label>
                                    </div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control is-expanded">
                                                {{ job_form.job_position(class="input", **{'x-model': 'fields.job' ~ loop.index, 'x-ref': 'job' ~ loop.index}) }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="box">
                            <h1 class="title is-size-4 has-text-centered">
                                ประวัติการศึกษา
                            </h1>
                            {% for degree_form in form.degrees %}
                                <div class="field is-horizontal">
                                    <div class="field-label is-normal">
                                        <label class="label">{{ degree_form.degree.label }} {{ loop.index }}</label>
                                    </div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control is-expanded">
                                                {{ degree_form.degree(class="input", **{"x-model": "fields.degree" ~ loop.index, 'x-ref': 'degree' ~ loop.index}) }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="box">
                            <h1 class="title is-size-4 has-text-centered">
                                ประสบการณ์ทำงาน
                            </h1>
                            {% for exp_form in form.experiences %}
                                <div class="field is-horizontal">
                                    <div class="field-label is-normal">
                                        <label class="label">{{ exp_form.experience.label }} {{ loop.index }}</label>
                                    </div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control is-expanded">
                                                {{ exp_form.experience(class="input", **{'x-model': 'fields.experience' ~ loop.index, 'x-ref': 'experience' ~ loop.index}) }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="box">
                            <h1 class="title is-size-4 has-text-centered">
                                วิสัยทัศน์ต่อการพัฒนาวิชาชีพเทคนิคการแพทย์
                            </h1>
                            {% for vision_form in form.visions %}
                                <div class="field is-horizontal">
                                    <div class="field-label is-normal">
                                        <label class="label">{{ vision_form.vision.label }} {{ loop.index }}</label>
                                    </div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control is-expanded">
                                                {{ vision_form.vision(class="textarea", **{'x-model': 'fields.vision' ~ loop.index, 'x-ref': 'vision' ~ loop.index}) }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <p class="notification"
                           :class="totalChars() > 720 ? 'is-danger is-light': 'is-success is-light'">
                            Total characters: <span
                                x-text="totalChars"></span>
                        </p>
                        <div class="field is-grouped is-grouped-centered">
                            <div class="field">
                                <p class="control">
                                    <button type="reset" class="button is-light">Reset</button>
                                </p>
                            </div>
                            <div class="field">
                                <p class="control">
                                    <input type="submit"
                                           :disabled="totalChars > 720"
                                           value="Submit" class="button is-success"/>
                                </p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="//unpkg.com/alpinejs" defer></script>
    <script>
        function formState() {
            return {
                fields: {
                    job1: '', job2: '', job3: '',
                    degree1: '', degree2: '', degree3: '',
                    vision1: '', vision2: '', vision3: '',
                    experience1: '', experience2: '', experience3: ''
                },
                get totalChars() {
                    return Object.values(this.fields).reduce((n, v) => n + v.length, 0);
                },
                init() {
                    // seed from actual rendered values
                    this.fields.job1 = this.$refs.job1.value || '';
                    this.fields.job2 = this.$refs.job2.value || '';
                    this.fields.job3 = this.$refs.job3.value || '';
                    this.fields.degree1 = this.$refs.degree1.value || '';
                    this.fields.degree2 = this.$refs.degree2.value || '';
                    this.fields.degree3 = this.$refs.degree3.value || '';
                    this.fields.vision1 = this.$refs.vision1.value || '';
                    this.fields.vision2 = this.$refs.vision2.value || '';
                    this.fields.vision3 = this.$refs.vision3.value || '';
                    this.fields.experience1 = this.$refs.experience1.value || '';
                    this.fields.experience2 = this.$refs.experience2.value || '';
                    this.fields.experience3 = this.$refs.experience3.value || '';
                }
            }
        }
    </script>
{% endblock %}
